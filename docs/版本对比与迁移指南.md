# Quasar 项目版本对比与迁移指南

## 📋 概述

本文档详细对比了新版本 Quasar 项目（quasar-project-code）与旧版本项目（xapp）之间的差异，并提供迁移指南和注意事项。

**对比项目：**
- **新版本路径**: `e:\Code\Quasracode\test1\quasar-project-code`
- **旧版本路径**: `e:\Code\Quasracode\xapp\xapp`

---

## 🎯 核心版本对比

### 框架与工具链版本

| 依赖包 | 新版本 | 旧版本 | 变化说明 |
|--------|--------|--------|----------|
| **Quasar** | ^2.16.0 | 2.12.3 | 主版本升级，新增功能 |
| **@quasar/app-webpack** | ^4.1.0 | ^3.9.2 | 主版本升级，配置方式变化 |
| **Vue** | ^3.5.22 | ^3.0.0 | 小版本升级，性能优化 |
| **Pinia** | ^3.0.1 | ^2.0.11 | 主版本升级，API 变化 |
| **ESLint** | ^9.14.0 | ^8.10.0 | 主版本升级，Flat Config |
| **vue-router** | ^4.0.12 | ^4.1.3 | 版本相近 |
| **axios** | ^1.2.1 | ^1.2.1 | 版本相同 |
| **vue-i18n** | ^11.0.0 | ^9.0.0 | 主版本升级 |

### Node.js 版本要求

**新版本要求：**
```json
"node": "^28 || ^26 || ^24 || ^22 || ^20 || ^18"
```
✅ 支持最新的 Node.js 版本

**旧版本要求：**
```json
"node": ">= 12.22.1"
```
⚠️ 支持较旧的 Node.js 版本

---

## 🔧 配置文件重大变化

### 1. 模块系统变化

#### 新版本：ES Module（ESM）

**package.json：**
```json
{
  "type": "module"
}
```

**quasar.config.js：**
```javascript
import { defineConfig } from '#q-app/wrappers'

export default defineConfig((ctx) => {
  return {
    // 配置...
  }
})
```

#### 旧版本：CommonJS

**quasar.config.js：**
```javascript
const { configure } = require("quasar/wrappers");

module.exports = configure(function (ctx) {
  return {
    // 配置...
  };
});
```

### 2. ESLint 配置革新

#### 新版本：Flat Config（eslint.config.js）

使用数组格式和 ESM 语法，更灵活的配置方式。

#### 旧版本：传统配置（.eslintrc.js）

使用对象格式和 CommonJS 语法。

### 3. Quasar 配置详细程度

#### 新版本配置（215 行）

**支持的平台：**
- ✅ SPA（单页应用）
- ✅ SSR（服务端渲染）
- ✅ PWA（渐进式 Web 应用）
- ✅ Cordova（iOS/Android）
- ✅ Capacitor（移动端）
- ✅ Electron（桌面应用）
- ✅ BEX（浏览器扩展）

#### 旧版本配置（46 行）

**仅支持：**
- ✅ SPA（单页应用）
- ✅ 基础 Web 开发

---

## 📦 依赖包差异详解

### 新版本独有依赖

| 依赖包 | 版本 | 用途 |
|--------|------|------|
| **three** | ^0.180.0 | 3D 图形渲染库 |
| **@types/three** | ^0.180.0 | Three.js TypeScript 类型 |
| **globals** | ^16.4.0 | 全局变量定义（ESLint） |
| **autoprefixer** | ^10.4.2 | CSS 自动添加浏览器前缀 |

**新增能力：**
- 🎨 3D 可视化和模型渲染
- 📐 TypeScript 类型支持
- 🔧 更现代的工具链配置

### 旧版本独有依赖

| 依赖包 | 版本 | 用途 |
|--------|------|------|
| **@ag-grid-community/all-modules** | ^27.3.0 | 企业级数据表格 |
| **ag-grid-vue3** | ^28.0.0 | AG Grid Vue3 适配器 |
| **echarts** | ^5.3.3 | 数据可视化图表库 |
| **@vuelidate/core** | ^2.0.3 | 表单验证核心库 |
| **laravel-echo** | ^1.13.1 | Laravel 实时通信客户端 |
| **pusher-js** | ^7.4.0 | WebSocket 实时推送 |
| **pinia-plugin-persistedstate** | ^1.6.3 | Pinia 状态持久化插件 |
| **json-editor-vue** | ^0.4.12 | JSON 编辑器 |
| **vue3-print-nb** | ^0.1.4 | 打印功能 |
| **vuedraggable** | ^4.1.0 | 拖拽组件 |
| **xlsx** | 0.20.0 | Excel 文件处理 |
| **dotenv** | ^16.3.1 | 环境变量管理 |
| **stylus** | ^0.64.0 | Stylus CSS 预处理器 |

**旧版本业务特点：**
- 📊 强大的数据表格和图表能力
- 🔐 完整的认证和实时通信系统
- 📄 丰富的文档处理功能（Excel、JSON）
- 🎯 成熟的业务功能组件

---

## 🏗️ 项目结构对比

### 新版本项目结构

```
quasar-project-code/
├── .editorconfig          # 编辑器配置
├── .npmrc                 # npm 配置
├── .prettierrc.json       # Prettier 配置
├── babel.config.js        # Babel 配置
├── eslint.config.js       # ESLint Flat Config ⭐
├── postcss.config.js      # PostCSS 配置
├── quasar.config.js       # Quasar 主配置（ESM）⭐
├── package.json           # 依赖配置（type: module）⭐
├── docs/                  # 📚 项目文档目录
├── scripts/               # 🔧 构建脚本
├── src/
│   ├── composables/      # ⭐ 组合式函数（新增）
│   ├── services/         # ⭐ 服务层（新增）
│   └── ...
└── src-cordova/          # ⭐ Cordova 移动应用（新增）
```

### 旧版本项目结构

```
xapp/
├── .eslintrc.js           # ESLint 传统配置
├── .postcssrc.js          # PostCSS 配置
├── .env                   # ⭐ 环境变量
├── .env.example           # 环境变量示例
└── src/
    ├── boot/
    │   ├── auth.js        # ⭐ 认证
    │   └── zglobal.js     # ⭐ 全局配置
    └── plugins/           # ⭐ 插件目录
```

---

## ⚠️ 特别注意事项

### 1. 模块系统迁移（重要！⭐⭐⭐）

#### 问题：CommonJS → ES Module

**旧版本代码：**
```javascript
// ❌ 不再支持
const router = require('./router')
module.exports = { }
```

**新版本代码：**
```javascript
// ✅ 必须使用
import router from './router/index.js'
export default { }
```

#### 迁移清单：

- [ ] 将所有 `require()` 改为 `import`
- [ ] 将所有 `module.exports` 改为 `export default` 或 `export`
- [ ] 文件扩展名必须显式指定（如 `./router/index.js`）
- [ ] 使用 `import.meta.env` 替代部分 `process.env`
- [ ] 检查第三方库是否支持 ESM

### 2. ESLint 配置迁移（⭐⭐⭐）

#### 配置格式完全不同

**迁移步骤：**

1. 删除旧配置文件：`.eslintrc.js`
2. 创建新配置文件：`eslint.config.js`
3. 转换为数组格式和 ESM 语法
4. 更新 package.json 中的 lint 脚本

### 3. 环境变量处理（⭐⭐⭐）

#### 重大变化：dotenv → 原生环境变量

**旧版本：**
```javascript
// 使用 dotenv
require("dotenv").config()
console.log(process.env.API_URL)
```

**新版本：**
```bash
# .env
VITE_API_URL=https://api.example.com
```

```javascript
// 在代码中使用
console.log(import.meta.env.VITE_API_URL)
```

**关键规则：**
- 环境变量必须以 `VITE_` 开头才能在客户端访问
- Node.js 环境仍可使用 `process.env`

### 4. Pinia 版本升级（⭐⭐）

#### Pinia 2 → Pinia 3

**组合式 API 写法（推荐）：**
```javascript
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'

export const useUserStore = defineStore('user', () => {
  const name = ref('')
  const upperName = computed(() => name.value.toUpperCase())
  
  function updateName(newName) {
    name.value = newName
  }
  
  return { name, upperName, updateName }
})
```

### 5. CSS 预处理器变化（⭐）

#### Stylus → SCSS

**旧版本（Stylus）：**
```stylus
.my-class
  color: red
  padding: 10px
```

**新版本（SCSS）：**
```scss
.my-class {
  color: red;
  padding: 10px;
}
```

### 6. Cordova 移动开发（⭐⭐）

**新版本新增完整的 Cordova 支持：**

```bash
# 初始化
npm run setup-cordova

# iOS 开发
npm run dev-ios

# Android 开发  
npm run dev-android

# 构建
npm run build-ios
npm run build-android
```

### 7. Boot 文件配置（⭐）

**新版本需要明确文件扩展名：**
```javascript
// quasar.config.js
boot: [
  'i18n.js',    // ⚠️ 必须加 .js
  'axios.js',
  'cordova.js'
]
```

---

## 🚀 迁移策略建议

### 方案 A：渐进式迁移（推荐）

适合正在运行的生产项目

**阶段划分：**

1. **准备阶段（第 1-2 周）**
   - 创建新版本项目骨架
   - 配置基础环境
   - 搭建 CI/CD 流程

2. **配置迁移（第 3 周）**
   - 转换配置文件到 ESM 格式
   - 迁移 ESLint 配置
   - 处理环境变量

3. **依赖处理（第 4-5 周）**
   - 安装新版本核心依赖
   - 迁移业务依赖
   - 测试兼容性

4. **代码迁移（第 6-8 周）**
   - 转换 CommonJS 到 ESM
   - 迁移组件和页面
   - 更新 API 调用

5. **测试与优化（第 9-10 周）**
   - 单元测试
   - 集成测试
   - 性能优化

6. **部署上线（第 11 周）**
   - 灰度发布
   - 正式上线

### 方案 B：业务依赖迁移

仅迁移旧版本的业务依赖到新版本

**步骤：**

```bash
# 进入新项目
cd quasar-project-code

# 安装数据表格
npm install ag-grid-community@^28.0.2 ag-grid-vue3@^28.0.0

# 安装图表
npm install echarts@^5.3.3

# 安装表单验证
npm install @vuelidate/core@^2.0.3 @vuelidate/validators@^2.0.3

# 安装实时通信
npm install laravel-echo@^1.13.1 pusher-js@^7.4.0

# 安装状态持久化
npm install pinia-plugin-persistedstate@^1.6.3

# 安装 Excel 处理
npm install xlsx@latest

# 安装其他工具
npm install vuedraggable@^4.1.0 vue3-print-nb@^0.1.4
```

---

## 📝 迁移检查清单

### 配置文件
- [ ] `package.json` 添加 `"type": "module"`
- [ ] `quasar.config.js` 转换为 ESM 格式
- [ ] `eslint.config.js` 使用 Flat Config
- [ ] 删除 `.eslintrc.js` 旧配置
- [ ] 更新 `postcss.config.js` 为 ESM
- [ ] 配置 `.env` 环境变量（VITE_ 前缀）

### 代码迁移
- [ ] 所有 `require()` 改为 `import`
- [ ] 所有 `module.exports` 改为 `export`
- [ ] 更新文件导入路径（添加扩展名）
- [ ] 替换 `process.env` 为 `import.meta.env`（客户端）
- [ ] 更新 Pinia store 语法
- [ ] 转换 Stylus 为 SCSS

### 依赖更新
- [ ] 更新 Quasar 到 ^2.16.0
- [ ] 更新 Vue 到 ^3.5.22
- [ ] 更新 Pinia 到 ^3.0.1
- [ ] 更新 ESLint 到 ^9.14.0
- [ ] 安装需要的业务依赖

### 测试验证
- [ ] 开发环境运行测试
- [ ] 构建生产版本测试
- [ ] 功能回归测试
- [ ] 性能测试
- [ ] 移动端测试（如使用 Cordova）

---

## 🔍 常见问题

### Q1: 为什么必须使用 ESM？

**A:** Quasar v4 和现代工具链全面拥抱 ESM，这是 JavaScript 的未来标准，提供更好的：
- 静态分析和 Tree Shaking
- 更快的构建速度
- 更好的 IDE 支持
- 原生浏览器支持

### Q2: 旧项目的业务依赖都能兼容吗？

**A:** 大部分依赖都兼容，但需要注意：
- 检查依赖是否支持 ESM
- 某些依赖可能需要更新版本
- 使用 CommonJS 的依赖可能需要特殊配置

### Q3: 环境变量为什么要加 VITE_ 前缀？

**A:** 这是 Vite 的安全机制，防止敏感信息泄露到客户端代码。只有 `VITE_` 开头的变量才会被注入到客户端bundle。

### Q4: Cordova 是必须的吗？

**A:** 不是必须的。如果只开发 Web 应用，可以删除 `src-cordova` 目录和相关配置。

### Q5: 能否保留 Stylus？

**A:** 理论上可以，但需要手动安装和配置 Stylus 相关依赖。建议迁移到 SCSS，生态更活跃。

### Q6: Pinia 3 有破坏性变化吗？

**A:** 大部分 API 保持兼容，但建议使用组合式 API 写法以获得更好的类型推断。

---

## 📚 参考资源

- [Quasar 官方文档](https://quasar.dev/)
- [Vue 3 官方文档](https://vuejs.org/)
- [Pinia 官方文档](https://pinia.vuejs.org/)
- [ESLint Flat Config](https://eslint.org/docs/latest/use/configure/configuration-files-new)
- [Vite 环境变量](https://vitejs.dev/guide/env-and-mode.html)

---

## 📞 支持

如有问题，请参考项目文档或联系开发团队。

---

**文档版本**: 1.0  
**创建日期**: 2025-11-18  
**最后更新**: 2025-11-18
