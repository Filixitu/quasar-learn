# Three.js 3D æ¨¡å‹å¯¼å…¥æŒ‡å— ğŸ¯

> **å®Œæ•´æŒ‡å—ï¼šå¦‚ä½•ä¸‹è½½ã€å¯¼å…¥å’Œä½¿ç”¨ 3D æ¨¡å‹**

---

## ğŸ“‹ ç›®å½•

1. [æ”¯æŒçš„æ¨¡å‹æ ¼å¼](#-æ”¯æŒçš„æ¨¡å‹æ ¼å¼)
2. [3D æ¨¡å‹èµ„æºç½‘ç«™](#-3d-æ¨¡å‹èµ„æºç½‘ç«™)
3. [å®‰è£…æ¨¡å‹åŠ è½½å™¨](#-å®‰è£…æ¨¡å‹åŠ è½½å™¨)
4. [åŸºç¡€æ¨¡å‹åŠ è½½](#-åŸºç¡€æ¨¡å‹åŠ è½½)
5. [é«˜çº§åŠŸèƒ½ç¤ºä¾‹](#-é«˜çº§åŠŸèƒ½ç¤ºä¾‹)
6. [æ¨¡å‹ä¼˜åŒ–æŠ€å·§](#-æ¨¡å‹ä¼˜åŒ–æŠ€å·§)
7. [å¸¸è§é—®é¢˜è§£å†³](#-å¸¸è§é—®é¢˜è§£å†³)

---

## ğŸ¨ æ”¯æŒçš„æ¨¡å‹æ ¼å¼

### 1. **æ¨èæ ¼å¼**

#### âœ… **GLTF/GLB (æ¨è)**
- **ä¼˜ç‚¹ï¼š** ç°ä»£æ ‡å‡†ã€ä½“ç§¯å°ã€æ”¯æŒåŠ¨ç”»ã€æè´¨ã€çº¹ç†
- **ç”¨é€”ï¼š** æ¸¸æˆã€äº§å“å±•ç¤ºã€å¤æ‚æ¨¡å‹
- **æ‰©å±•åï¼š** `.gltf` (JSON + å¤–éƒ¨æ–‡ä»¶) æˆ– `.glb` (äºŒè¿›åˆ¶)

#### âœ… **FBX**
- **ä¼˜ç‚¹ï¼š** å¹¿æ³›æ”¯æŒã€åŠ¨ç”»ä¸°å¯Œ
- **ç”¨é€”ï¼š** è§’è‰²åŠ¨ç”»ã€å¤æ‚åœºæ™¯
- **æ‰©å±•åï¼š** `.fbx`

#### âœ… **OBJ**
- **ä¼˜ç‚¹ï¼š** ç®€å•ã€é€šç”¨æ€§å¼º
- **ç¼ºç‚¹ï¼š** ä¸æ”¯æŒåŠ¨ç”»å’Œå¤æ‚æè´¨
- **ç”¨é€”ï¼š** é™æ€æ¨¡å‹ã€å»ºç­‘
- **æ‰©å±•åï¼š** `.obj` (é€šå¸¸é…åˆ `.mtl` æè´¨æ–‡ä»¶)

### 2. **å…¶ä»–æ”¯æŒæ ¼å¼**

- **STL** - 3D æ‰“å°æ¨¡å‹
- **PLY** - ç‚¹äº‘æ•°æ®
- **DAE (Collada)** - å¼€æ”¾æ ‡å‡†
- **3DS** - 3ds Max æ ¼å¼

---

## ğŸŒ 3D æ¨¡å‹èµ„æºç½‘ç«™

### ğŸ†“ **å…è´¹èµ„æº**

#### 1. **Sketchfab** 
- **ç½‘å€ï¼š** https://sketchfab.com
- **ç‰¹ç‚¹ï¼š** é«˜è´¨é‡ã€å¯é¢„è§ˆã€æ”¯æŒä¸‹è½½
- **æ ¼å¼ï¼š** GLTFã€OBJã€FBX
- **ç­›é€‰ï¼š** é€‰æ‹© "Downloadable" å’Œ "CC Attribution"

#### 2. **Poly Pizza**
- **ç½‘å€ï¼š** https://poly.pizza
- **ç‰¹ç‚¹ï¼š** ç®€å•æ¨¡å‹ã€ä½é¢æ•°
- **æ ¼å¼ï¼š** GLTF

#### 3. **Free3D**
- **ç½‘å€ï¼š** https://free3d.com
- **ç‰¹ç‚¹ï¼š** å„ç§ç±»åˆ«æ¨¡å‹
- **æ ¼å¼ï¼š** å¤šç§æ ¼å¼

#### 4. **TurboSquid (å…è´¹åŒº)**
- **ç½‘å€ï¼š** https://www.turbosquid.com/Search/3D-Models/free
- **ç‰¹ç‚¹ï¼š** ä¸“ä¸šçº§æ¨¡å‹
- **æ ¼å¼ï¼š** å¤šç§æ ¼å¼

### ğŸ’° **ä»˜è´¹èµ„æº**

- **CGTrader** - https://www.cgtrader.com
- **TurboSquid** - https://www.turbosquid.com
- **Unity Asset Store** - https://assetstore.unity.com

---

## ğŸ“¦ å®‰è£…æ¨¡å‹åŠ è½½å™¨

åœ¨é¡¹ç›®ä¸­å®‰è£…å¿…è¦çš„åŠ è½½å™¨ï¼š

```bash
# Three.js å·²ç»åŒ…å«äº†å¤§éƒ¨åˆ†åŠ è½½å™¨ï¼Œæ— éœ€é¢å¤–å®‰è£…
# ä½†å¦‚æœéœ€è¦ç‰¹å®šåŠ è½½å™¨ï¼Œå¯ä»¥å®‰è£…ï¼š

# GLTF åŠ è½½å™¨ï¼ˆæ¨èï¼ŒThree.js å†…ç½®ï¼‰
# æ— éœ€é¢å¤–å®‰è£…

# FBX åŠ è½½å™¨ï¼ˆThree.js å†…ç½®ï¼‰
# æ— éœ€é¢å¤–å®‰è£…

# å…¶ä»–åŠ è½½å™¨
npm install three-obj-loader
npm install three-fbx-loader
```

---

## ğŸš€ åŸºç¡€æ¨¡å‹åŠ è½½

### 1. **GLTF æ¨¡å‹åŠ è½½ (æ¨è)**

åˆ›å»º `src/components/demos/Model3DDemo.vue`ï¼š

```vue
<template>
  <div class="model-demo-container">
    <q-card class="model-card">
      <q-card-section>
        <div class="text-h6 flex items-center">
          <q-icon name="view_in_ar" class="q-mr-sm" />
          3D æ¨¡å‹åŠ è½½æ¼”ç¤º
        </div>
        <div class="text-subtitle2 text-grey-7">
          æ”¯æŒ GLTFã€FBXã€OBJ ç­‰å¤šç§æ ¼å¼
        </div>
      </q-card-section>

      <q-separator />

      <!-- 3D æ¸²æŸ“åŒºåŸŸ -->
      <q-card-section class="q-pa-none">
        <div 
          ref="modelContainer" 
          class="model-canvas-container"
          :style="{ height: canvasHeight + 'px' }"
        >
          <div v-if="loading" class="loading-overlay">
            <q-spinner-cube size="50px" color="primary" />
            <div class="text-subtitle1 q-mt-md">æ­£åœ¨åŠ è½½ 3D æ¨¡å‹...</div>
            <div class="text-caption">{{ loadingProgress }}%</div>
          </div>
          
          <div v-if="error" class="error-overlay">
            <q-icon name="error" size="48px" color="negative" />
            <div class="text-h6 q-mt-md">æ¨¡å‹åŠ è½½å¤±è´¥</div>
            <div class="text-body2 q-mt-sm text-grey-7">{{ error }}</div>
            <q-btn color="primary" outline @click="loadDefaultModel" class="q-mt-md">
              åŠ è½½é»˜è®¤æ¨¡å‹
            </q-btn>
          </div>
        </div>
      </q-card-section>

      <q-separator />

      <!-- æ§åˆ¶é¢æ¿ -->
      <q-card-section>
        <div class="text-subtitle2 q-mb-md flex items-center">
          <q-icon name="settings" class="q-mr-sm" />
          æ¨¡å‹æ§åˆ¶
        </div>
        
        <div class="row q-gutter-md">
          <q-btn 
            color="primary" 
            icon="folder_open"
            label="é€‰æ‹©æ¨¡å‹æ–‡ä»¶"
            @click="openFileDialog"
            :disable="loading"
          />
          <q-btn 
            color="secondary" 
            icon="cloud_download"
            label="åŠ è½½åœ¨çº¿æ¨¡å‹"
            @click="loadOnlineModel"
            :disable="loading"
          />
          <q-btn 
            color="accent" 
            icon="refresh"
            label="é‡ç½®è§†è§’"
            @click="resetCamera"
            :disable="!modelLoaded"
          />
        </div>

        <!-- æ–‡ä»¶é€‰æ‹©ï¼ˆéšè—ï¼‰ -->
        <input 
          ref="fileInput"
          type="file"
          accept=".gltf,.glb,.fbx,.obj"
          @change="handleFileSelect"
          style="display: none"
        />
      </q-card-section>

      <!-- é¢„è®¾æ¨¡å‹é€‰æ‹© -->
      <q-card-section>
        <div class="text-subtitle2 q-mb-md">é¢„è®¾æ¨¡å‹</div>
        <div class="row q-gutter-sm">
          <q-btn 
            v-for="model in presetModels" 
            :key="model.name"
            size="sm"
            :color="currentModel === model.name ? 'primary' : 'grey-5'"
            :label="model.name"
            @click="loadPresetModel(model)"
            :loading="loading && currentModel === model.name"
          />
        </div>
      </q-card-section>

      <!-- æ¨¡å‹ä¿¡æ¯ -->
      <q-card-section v-if="modelInfo">
        <div class="text-subtitle2 q-mb-md">æ¨¡å‹ä¿¡æ¯</div>
        <div class="model-info-grid">
          <div class="info-item">
            <div class="info-label">é¡¶ç‚¹æ•°</div>
            <div class="info-value">{{ modelInfo.vertices }}</div>
          </div>
          <div class="info-item">
            <div class="info-label">é¢æ•°</div>
            <div class="info-value">{{ modelInfo.faces }}</div>
          </div>
          <div class="info-item">
            <div class="info-label">åŠ¨ç”»</div>
            <div class="info-value">{{ modelInfo.animations }}</div>
          </div>
          <div class="info-item">
            <div class="info-label">æ–‡ä»¶å¤§å°</div>
            <div class="info-value">{{ modelInfo.size }}</div>
          </div>
        </div>
      </q-card-section>

      <!-- åŠ¨ç”»æ§åˆ¶ -->
      <q-card-section v-if="animations.length > 0">
        <div class="text-subtitle2 q-mb-md">åŠ¨ç”»æ§åˆ¶</div>
        <div class="row q-gutter-md items-center">
          <q-select
            v-model="selectedAnimation"
            :options="animationOptions"
            label="é€‰æ‹©åŠ¨ç”»"
            style="min-width: 150px"
            @update:model-value="playAnimation"
          />
          <q-btn 
            :icon="isAnimationPlaying ? 'pause' : 'play_arrow'"
            :label="isAnimationPlaying ? 'æš‚åœ' : 'æ’­æ”¾'"
            @click="toggleAnimation"
            :disable="!selectedAnimation"
          />
        </div>
      </q-card-section>

      <!-- ä½¿ç”¨è¯´æ˜ -->
      <q-card-section>
        <q-expansion-item
          icon="help_outline"
          label="ä½¿ç”¨è¯´æ˜"
          caption="äº†è§£å¦‚ä½•ä½¿ç”¨ 3D æ¨¡å‹åŠŸèƒ½"
        >
          <div class="q-pa-md bg-grey-1">
            <div class="text-subtitle2 q-mb-sm">æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼š</div>
            <ul class="q-pl-md">
              <li><strong>GLTF/GLBï¼š</strong> æ¨èæ ¼å¼ï¼Œæ”¯æŒåŠ¨ç”»å’Œæè´¨</li>
              <li><strong>FBXï¼š</strong> æ”¯æŒå¤æ‚åŠ¨ç”»å’Œåœºæ™¯</li>
              <li><strong>OBJï¼š</strong> ç®€å•é™æ€æ¨¡å‹</li>
            </ul>
            
            <div class="text-subtitle2 q-mt-md q-mb-sm">æ“ä½œè¯´æ˜ï¼š</div>
            <ul class="q-pl-md">
              <li><strong>é¼ æ ‡æ‹–æ‹½ï¼š</strong> æ—‹è½¬æ¨¡å‹</li>
              <li><strong>æ»šè½®ï¼š</strong> ç¼©æ”¾æ¨¡å‹</li>
              <li><strong>å³é”®æ‹–æ‹½ï¼š</strong> å¹³ç§»è§†è§’</li>
            </ul>
            
            <div class="text-subtitle2 q-mt-md q-mb-sm">æ¨èæ¨¡å‹ç½‘ç«™ï¼š</div>
            <ul class="q-pl-md">
              <li><a href="https://sketchfab.com" target="_blank">Sketchfab</a> - é«˜è´¨é‡æ¨¡å‹</li>
              <li><a href="https://poly.pizza" target="_blank">Poly Pizza</a> - ç®€å•æ¨¡å‹</li>
              <li><a href="https://free3d.com" target="_blank">Free3D</a> - å…è´¹æ¨¡å‹</li>
            </ul>
          </div>
        </q-expansion-item>
      </q-card-section>
    </q-card>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue'
import { useQuasar } from 'quasar'

const $q = useQuasar()

// å“åº”å¼æ•°æ®
const modelContainer = ref(null)
const fileInput = ref(null)
const canvasHeight = ref(500)
const loading = ref(false)
const loadingProgress = ref(0)
const error = ref('')
const modelLoaded = ref(false)
const currentModel = ref('')
const modelInfo = ref(null)
const selectedAnimation = ref('')
const isAnimationPlaying = ref(false)
const animations = ref([])

// Three.js å¯¹è±¡
let THREE = null
let scene, camera, renderer, controls
let currentLoadedModel = null
let animationMixer = null
let animationActions = []
let animationId = null

// é¢„è®¾æ¨¡å‹åˆ—è¡¨
const presetModels = ref([
  {
    name: 'ç«‹æ–¹ä½“',
    type: 'primitive',
    create: () => new THREE.BoxGeometry(1, 1, 1)
  },
  {
    name: 'çƒä½“',
    type: 'primitive', 
    create: () => new THREE.SphereGeometry(0.8, 32, 32)
  },
  {
    name: 'åœ¨çº¿æ¨¡å‹',
    type: 'gltf',
    url: 'https://threejs.org/examples/models/gltf/DamagedHelmet/DamagedHelmet.gltf'
  }
])

// åŠ¨ç”»é€‰é¡¹
const animationOptions = computed(() => {
  return animations.value.map(anim => ({
    label: anim.name,
    value: anim.name
  }))
})

// åˆå§‹åŒ– Three.js åœºæ™¯
async function initThreeJS() {
  try {
    // åŠ¨æ€å¯¼å…¥ Three.js
    THREE = await import('three')
    
    // åˆ›å»ºåœºæ™¯
    scene = new THREE.Scene()
    scene.background = new THREE.Color(0xf0f0f0)

    // åˆ›å»ºç›¸æœº
    const aspect = modelContainer.value.clientWidth / canvasHeight.value
    camera = new THREE.PerspectiveCamera(45, aspect, 0.1, 1000)
    camera.position.set(3, 3, 3)

    // åˆ›å»ºæ¸²æŸ“å™¨
    renderer = new THREE.WebGLRenderer({ antialias: true })
    renderer.setSize(modelContainer.value.clientWidth, canvasHeight.value)
    renderer.shadowMap.enabled = true
    renderer.shadowMap.type = THREE.PCFSoftShadowMap
    renderer.outputEncoding = THREE.sRGBEncoding
    renderer.toneMapping = THREE.ACESFilmicToneMapping

    modelContainer.value.appendChild(renderer.domElement)

    // æ·»åŠ æ§åˆ¶å™¨ï¼ˆè½¨é“æ§åˆ¶ï¼‰
    const { OrbitControls } = await import('three/examples/jsm/controls/OrbitControls.js')
    controls = new OrbitControls(camera, renderer.domElement)
    controls.enableDamping = true
    controls.dampingFactor = 0.05

    // æ·»åŠ å…‰ç…§
    setupLighting()

    // å¼€å§‹åŠ¨ç”»å¾ªç¯
    animate()
    
    // åŠ è½½é»˜è®¤æ¨¡å‹
    loadDefaultModel()

  } catch (err) {
    error.value = '3D å¼•æ“åˆå§‹åŒ–å¤±è´¥ï¼š' + err.message
    console.error('Three.js initialization failed:', err)
  }
}

// è®¾ç½®å…‰ç…§
function setupLighting() {
  // ç¯å¢ƒå…‰
  const ambientLight = new THREE.AmbientLight(0x404040, 0.6)
  scene.add(ambientLight)

  // æ–¹å‘å…‰
  const directionalLight = new THREE.DirectionalLight(0xffffff, 1)
  directionalLight.position.set(5, 5, 5)
  directionalLight.castShadow = true
  directionalLight.shadow.mapSize.width = 2048
  directionalLight.shadow.mapSize.height = 2048
  scene.add(directionalLight)

  // é¢å¤–çš„å¡«å……å…‰
  const fillLight = new THREE.DirectionalLight(0xffffff, 0.3)
  fillLight.position.set(-5, 0, -5)
  scene.add(fillLight)
}

// åŠ¨ç”»å¾ªç¯
function animate() {
  animationId = requestAnimationFrame(animate)
  
  if (controls) {
    controls.update()
  }
  
  if (animationMixer) {
    animationMixer.update(0.016) // 60fps
  }
  
  renderer.render(scene, camera)
}

// åŠ è½½ GLTF æ¨¡å‹
async function loadGLTFModel(url) {
  try {
    const { GLTFLoader } = await import('three/examples/jsm/loaders/GLTFLoader.js')
    const loader = new GLTFLoader()

    return new Promise((resolve, reject) => {
      loader.load(
        url,
        (gltf) => {
          resolve(gltf)
        },
        (progress) => {
          const percent = Math.round((progress.loaded / progress.total) * 100)
          loadingProgress.value = percent
        },
        (error) => {
          reject(error)
        }
      )
    })
  } catch (err) {
    throw new Error('GLTF åŠ è½½å™¨åˆå§‹åŒ–å¤±è´¥ï¼š' + err.message)
  }
}

// åŠ è½½ FBX æ¨¡å‹
async function loadFBXModel(url) {
  try {
    const { FBXLoader } = await import('three/examples/jsm/loaders/FBXLoader.js')
    const loader = new FBXLoader()

    return new Promise((resolve, reject) => {
      loader.load(
        url,
        (fbx) => {
          resolve(fbx)
        },
        (progress) => {
          const percent = Math.round((progress.loaded / progress.total) * 100)
          loadingProgress.value = percent
        },
        (error) => {
          reject(error)
        }
      )
    })
  } catch (err) {
    throw new Error('FBX åŠ è½½å™¨åˆå§‹åŒ–å¤±è´¥ï¼š' + err.message)
  }
}

// åŠ è½½ OBJ æ¨¡å‹
async function loadOBJModel(url) {
  try {
    const { OBJLoader } = await import('three/examples/jsm/loaders/OBJLoader.js')
    const loader = new OBJLoader()

    return new Promise((resolve, reject) => {
      loader.load(
        url,
        (obj) => {
          resolve(obj)
        },
        (progress) => {
          const percent = Math.round((progress.loaded / progress.total) * 100)
          loadingProgress.value = percent
        },
        (error) => {
          reject(error)
        }
      )
    })
  } catch (err) {
    throw new Error('OBJ åŠ è½½å™¨åˆå§‹åŒ–å¤±è´¥ï¼š' + err.message)
  }
}

// æ¸…ç†å½“å‰æ¨¡å‹
function clearCurrentModel() {
  if (currentLoadedModel) {
    scene.remove(currentLoadedModel)
    
    // æ¸…ç†å‡ ä½•ä½“å’Œæè´¨
    currentLoadedModel.traverse((child) => {
      if (child.geometry) {
        child.geometry.dispose()
      }
      if (child.material) {
        if (Array.isArray(child.material)) {
          child.material.forEach(material => material.dispose())
        } else {
          child.material.dispose()
        }
      }
    })
    
    currentLoadedModel = null
  }
  
  // æ¸…ç†åŠ¨ç”»
  if (animationMixer) {
    animationMixer.stopAllAction()
    animationMixer = null
  }
  animationActions = []
  animations.value = []
  selectedAnimation.value = ''
  isAnimationPlaying.value = false
}

// æ·»åŠ æ¨¡å‹åˆ°åœºæ™¯
function addModelToScene(model, modelData = null) {
  clearCurrentModel()
  
  // è®¡ç®—æ¨¡å‹è¾¹ç•Œå¹¶è°ƒæ•´å¤§å°
  const box = new THREE.Box3().setFromObject(model)
  const size = box.getSize(new THREE.Vector3())
  const maxSize = Math.max(size.x, size.y, size.z)
  const scale = 2 / maxSize // æ ‡å‡†åŒ–åˆ°2ä¸ªå•ä½å¤§å°
  
  model.scale.multiplyScalar(scale)
  
  // å±…ä¸­æ¨¡å‹
  const center = box.getCenter(new THREE.Vector3())
  model.position.sub(center.multiplyScalar(scale))
  
  // å¯ç”¨é˜´å½±
  model.traverse((child) => {
    if (child.isMesh) {
      child.castShadow = true
      child.receiveShadow = true
    }
  })
  
  scene.add(model)
  currentLoadedModel = model
  
  // å¤„ç†åŠ¨ç”»
  if (modelData && modelData.animations && modelData.animations.length > 0) {
    animationMixer = new THREE.AnimationMixer(model)
    animations.value = modelData.animations.map(clip => ({
      name: clip.name,
      clip: clip
    }))
    
    // åˆ›å»ºåŠ¨ç”»åŠ¨ä½œ
    modelData.animations.forEach(clip => {
      const action = animationMixer.clipAction(clip)
      animationActions.push(action)
    })
  }
  
  // æ›´æ–°æ¨¡å‹ä¿¡æ¯
  updateModelInfo(model)
  
  modelLoaded.value = true
  
  // è°ƒæ•´ç›¸æœºä½ç½®
  fitCameraToModel(model)
}

// æ›´æ–°æ¨¡å‹ä¿¡æ¯
function updateModelInfo(model) {
  let vertices = 0
  let faces = 0
  
  model.traverse((child) => {
    if (child.geometry) {
      if (child.geometry.attributes.position) {
        vertices += child.geometry.attributes.position.count
      }
      if (child.geometry.index) {
        faces += child.geometry.index.count / 3
      } else if (child.geometry.attributes.position) {
        faces += child.geometry.attributes.position.count / 3
      }
    }
  })
  
  modelInfo.value = {
    vertices: vertices.toLocaleString(),
    faces: Math.round(faces).toLocaleString(),
    animations: animations.value.length,
    size: 'è®¡ç®—ä¸­...'
  }
}

// è°ƒæ•´ç›¸æœºä»¥é€‚åº”æ¨¡å‹
function fitCameraToModel(model) {
  const box = new THREE.Box3().setFromObject(model)
  const size = box.getSize(new THREE.Vector3())
  const maxSize = Math.max(size.x, size.y, size.z)
  
  const distance = maxSize * 2
  camera.position.set(distance, distance * 0.8, distance)
  camera.lookAt(0, 0, 0)
  
  if (controls) {
    controls.reset()
  }
}

// åŠ è½½é¢„è®¾æ¨¡å‹
async function loadPresetModel(model) {
  loading.value = true
  error.value = ''
  currentModel.value = model.name
  loadingProgress.value = 0
  
  try {
    if (model.type === 'primitive') {
      // åˆ›å»ºåŸºç¡€å‡ ä½•ä½“
      const geometry = model.create()
      const material = new THREE.MeshPhongMaterial({ 
        color: 0x00ff88,
        shininess: 100
      })
      const mesh = new THREE.Mesh(geometry, material)
      addModelToScene(mesh)
    } else if (model.type === 'gltf') {
      // åŠ è½½ GLTF æ¨¡å‹
      const gltf = await loadGLTFModel(model.url)
      addModelToScene(gltf.scene, gltf)
    }
    
    $q.notify({
      message: `${model.name} åŠ è½½æˆåŠŸï¼`,
      type: 'positive',
      position: 'top'
    })
    
  } catch (err) {
    error.value = `æ¨¡å‹åŠ è½½å¤±è´¥: ${err.message}`
    console.error('Model loading failed:', err)
    
    $q.notify({
      message: `${model.name} åŠ è½½å¤±è´¥`,
      type: 'negative',
      position: 'top'
    })
  } finally {
    loading.value = false
  }
}

// åŠ è½½é»˜è®¤æ¨¡å‹
function loadDefaultModel() {
  loadPresetModel(presetModels.value[0])
}

// åŠ è½½åœ¨çº¿æ¨¡å‹
function loadOnlineModel() {
  loadPresetModel(presetModels.value[2])
}

// æ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
function openFileDialog() {
  fileInput.value.click()
}

// å¤„ç†æ–‡ä»¶é€‰æ‹©
async function handleFileSelect(event) {
  const file = event.target.files[0]
  if (!file) return
  
  loading.value = true
  error.value = ''
  currentModel.value = file.name
  
  try {
    const url = URL.createObjectURL(file)
    const extension = file.name.split('.').pop().toLowerCase()
    
    let modelData
    switch (extension) {
      case 'gltf':
      case 'glb':
        modelData = await loadGLTFModel(url)
        addModelToScene(modelData.scene, modelData)
        break
      case 'fbx':
        modelData = await loadFBXModel(url)
        addModelToScene(modelData, { animations: modelData.animations || [] })
        break
      case 'obj':
        modelData = await loadOBJModel(url)
        addModelToScene(modelData)
        break
      default:
        throw new Error(`ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼: ${extension}`)
    }
    
    // æ¸…ç† URL
    URL.revokeObjectURL(url)
    
    $q.notify({
      message: 'æ¨¡å‹åŠ è½½æˆåŠŸï¼',
      type: 'positive',
      position: 'top'
    })
    
  } catch (err) {
    error.value = `æ–‡ä»¶åŠ è½½å¤±è´¥: ${err.message}`
    console.error('File loading failed:', err)
    
    $q.notify({
      message: 'æ–‡ä»¶åŠ è½½å¤±è´¥',
      type: 'negative',
      position: 'top'
    })
  } finally {
    loading.value = false
  }
}

// é‡ç½®ç›¸æœº
function resetCamera() {
  if (currentLoadedModel) {
    fitCameraToModel(currentLoadedModel)
  }
}

// æ’­æ”¾åŠ¨ç”»
function playAnimation(animationName) {
  if (!animationMixer || !animationName) return
  
  // åœæ­¢æ‰€æœ‰åŠ¨ç”»
  animationActions.forEach(action => {
    action.stop()
  })
  
  // æ‰¾åˆ°å¹¶æ’­æ”¾é€‰ä¸­çš„åŠ¨ç”»
  const animation = animations.value.find(anim => anim.name === animationName)
  if (animation) {
    const action = animationMixer.clipAction(animation.clip)
    action.reset()
    action.play()
    isAnimationPlaying.value = true
  }
}

// åˆ‡æ¢åŠ¨ç”»æ’­æ”¾çŠ¶æ€
function toggleAnimation() {
  if (!animationMixer) return
  
  if (isAnimationPlaying.value) {
    animationMixer.timeScale = 0
    isAnimationPlaying.value = false
  } else {
    animationMixer.timeScale = 1
    isAnimationPlaying.value = true
  }
}

// çª—å£å¤§å°è°ƒæ•´
function onWindowResize() {
  if (!camera || !renderer || !modelContainer.value) return
  
  const width = modelContainer.value.clientWidth
  const height = canvasHeight.value
  
  camera.aspect = width / height
  camera.updateProjectionMatrix()
  renderer.setSize(width, height)
}

// é˜²æŠ–å¤„ç†
let resizeTimeout = null
function handleResize() {
  if (resizeTimeout) clearTimeout(resizeTimeout)
  resizeTimeout = setTimeout(onWindowResize, 100)
}

// ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  initThreeJS()
  window.addEventListener('resize', handleResize)
})

onUnmounted(() => {
  window.removeEventListener('resize', handleResize)
  
  // æ¸…ç† Three.js èµ„æº
  if (animationId) {
    cancelAnimationFrame(animationId)
  }
  
  clearCurrentModel()
  
  if (renderer) {
    renderer.dispose()
    if (modelContainer.value && renderer.domElement) {
      modelContainer.value.removeChild(renderer.domElement)
    }
  }
  
  if (resizeTimeout) {
    clearTimeout(resizeTimeout)
  }
})
</script>

<style scoped>
.model-demo-container {
  width: 100%;
  max-width: 1000px;
  margin: 0 auto;
}

.model-card {
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.model-canvas-container {
  position: relative;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  overflow: hidden;
  background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%);
}

.loading-overlay,
.error-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(245, 245, 245, 0.95);
  z-index: 10;
}

.model-info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 1rem;
  margin-top: 0.5rem;
}

.info-item {
  text-align: center;
  padding: 0.75rem;
  background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
  border-radius: 8px;
  border-left: 3px solid #1976d2;
}

.info-label {
  font-size: 0.85em;
  opacity: 0.7;
  margin-bottom: 4px;
}

.info-value {
  font-size: 1.1em;
  font-weight: 600;
  color: #1976d2;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 600px) {
  .model-demo-container {
    padding: 0.5rem;
  }
  
  .model-canvas-container {
    height: 350px !important;
  }
  
  .model-info-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* åŠ¨ç”»æ•ˆæœ */
.model-card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.model-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
}

.info-item {
  transition: transform 0.2s ease;
}

.info-item:hover {
  transform: scale(1.02);
}
</style>
```

---

## ğŸ® ä½¿ç”¨æ­¥éª¤

### 1. **å°†ç»„ä»¶æ·»åŠ åˆ°é¡¹ç›®**

åœ¨ `src/pages/ComponentsPage.vue` ä¸­æ·»åŠ ï¼š

```javascript
// å¯¼å…¥æ–°ç»„ä»¶
import Model3DDemo from '../components/demos/Model3DDemo.vue'

// æ·»åŠ åˆ°ç»„ä»¶æ˜ å°„
const componentMap = {
  // ... å…¶ä»–ç»„ä»¶
  Model3DDemo,
}

// åœ¨ 3D å›¾å½¢æ¸²æŸ“åˆ†ç±»ä¸­æ·»åŠ 
{
  label: '3D å›¾å½¢æ¸²æŸ“',
  icon: 'view_in_ar',
  components: [
    { id: 'ThreeJSDemo', name: 'Three.js 3D åœºæ™¯', description: 'WebGL 3D å›¾å½¢æ¸²æŸ“å’ŒåŠ¨ç”»æ¼”ç¤º' },
    { id: 'Model3DDemo', name: '3D æ¨¡å‹åŠ è½½å™¨', description: 'æ”¯æŒ GLTFã€FBXã€OBJ ç­‰æ ¼å¼çš„ 3D æ¨¡å‹åŠ è½½' },
  ]
},
```

### 2. **ä¸‹è½½å’Œä½¿ç”¨ 3D æ¨¡å‹**

#### ğŸ” **æ¨èç½‘ç«™ä¸‹è½½æ­¥éª¤ï¼š**

1. **è®¿é—® Sketchfab**
   - æ‰“å¼€ https://sketchfab.com
   - æœç´¢ä½ æƒ³è¦çš„æ¨¡å‹
   - ç­›é€‰æ¡ä»¶é€‰æ‹© "Downloadable" + "CC Attribution"
   - ä¸‹è½½ GLTF æ ¼å¼

2. **æœ¬åœ°ä½¿ç”¨**
   - å°†ä¸‹è½½çš„æ¨¡å‹æ–‡ä»¶æ”¾åˆ° `public/models/` ç›®å½•
   - åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„åŠ è½½ï¼š`/models/your-model.gltf`

3. **åœ¨çº¿ä½¿ç”¨**
   - ç›´æ¥ä½¿ç”¨æ¨¡å‹çš„ CDN é“¾æ¥
   - ç¡®ä¿ CORS ç­–ç•¥å…è®¸è·¨åŸŸè®¿é—®

---

## ğŸ¯ å®é™…åº”ç”¨ç¤ºä¾‹

### 1. **äº§å“å±•ç¤º**
```javascript
// ç”µå•†äº§å“ 3D é¢„è§ˆ
const productModels = [
  { name: 'æ¤…å­', url: '/models/chair.gltf' },
  { name: 'æ¡Œå­', url: '/models/table.gltf' },
  { name: 'æ²™å‘', url: '/models/sofa.gltf' }
]
```

### 2. **è§’è‰²åŠ¨ç”»**
```javascript
// åŠ è½½å¸¦åŠ¨ç”»çš„è§’è‰²æ¨¡å‹
const characterModel = '/models/character-animated.fbx'
// æ”¯æŒè¡Œèµ°ã€è·‘æ­¥ã€è·³è·ƒç­‰åŠ¨ç”»
```

### 3. **å»ºç­‘å¯è§†åŒ–**
```javascript
// å»ºç­‘æ¨¡å‹å±•ç¤º
const buildingModel = '/models/house.gltf'
// æ”¯æŒæè´¨åˆ‡æ¢ã€ç¯å…‰æ•ˆæœ
```

---

## âš¡ ä¼˜åŒ–å»ºè®®

### 1. **æ–‡ä»¶å¤§å°ä¼˜åŒ–**
- ä½¿ç”¨ **GLTF/GLB** æ ¼å¼ï¼ˆå‹ç¼©ç‡é«˜ï¼‰
- å‹ç¼©çº¹ç†ï¼ˆJPG è€Œä¸æ˜¯ PNGï¼‰
- å‡å°‘å¤šè¾¹å½¢æ•°é‡
- ç§»é™¤ä¸å¿…è¦çš„åŠ¨ç”»

### 2. **åŠ è½½æ€§èƒ½ä¼˜åŒ–**
```javascript
// é¢„åŠ è½½æ¨¡å‹
const modelCache = new Map()
async function preloadModel(url) {
  if (!modelCache.has(url)) {
    const model = await loadGLTFModel(url)
    modelCache.set(url, model)
  }
  return modelCache.get(url)
}
```

### 3. **å†…å­˜ç®¡ç†**
```javascript
// åŠæ—¶æ¸…ç†ä¸ç”¨çš„æ¨¡å‹
function disposeModel(model) {
  model.traverse((child) => {
    if (child.geometry) child.geometry.dispose()
    if (child.material) {
      if (Array.isArray(child.material)) {
        child.material.forEach(mat => mat.dispose())
      } else {
        child.material.dispose()
      }
    }
  })
}
```

---

## ğŸ‰ æ€»ç»“

é€šè¿‡è¿™ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥ï¼š

âœ… **ä¸‹è½½å„ç§ 3D æ¨¡å‹** - æ”¯æŒå¤šä¸ªå…è´¹èµ„æºç½‘ç«™  
âœ… **å¯¼å…¥å¤šç§æ ¼å¼** - GLTFã€FBXã€OBJ ç­‰  
âœ… **å®æ—¶é¢„è§ˆ** - æ‹–æ‹½ã€ç¼©æ”¾ã€æ—‹è½¬äº¤äº’  
âœ… **åŠ¨ç”»æ’­æ”¾** - æ”¯æŒæ¨¡å‹åŠ¨ç”»æ§åˆ¶  
âœ… **æ€§èƒ½ä¼˜åŒ–** - å†…å­˜ç®¡ç†å’ŒåŠ è½½ä¼˜åŒ–  

ç«‹å³ä½“éªŒï¼šè¿è¡Œé¡¹ç›®åè®¿é—® "3D å›¾å½¢æ¸²æŸ“" â†’ "3D æ¨¡å‹åŠ è½½å™¨" ğŸš€âœ¨
